# pathfinders

Игра про поиск сокровищ в лабиринте. По лабиринту раскиданы золотые монеты, которые могут собирать полностью автоматические роботы. Задача игроков - написать программу управления роботом для сбора монет. Надо помнить, что другие роботы не стоят на месте и тоже ищут сокровища.

Оригинальная идея игры заимствована из проекта [mipt-cs-labyrinth-challenge](https://github.com/avasyukov/mipt-cs-labyrinth-challenge)

## Как запустить игру?

Для работы игра требует python2.7 и [Flask](http://flask.pocoo.org/) для web интерфейса. Рекомендую поставить Flask из репозитария вашего дистрибутива Linux. Тестирование производилось на Linux (Fedora 25). Работоспособность на Windows не гарантируется.

1. Склонировать репозитарий из Github
2. Запустить из командной строки 

```
$ ./pathfinders.py 
Process 'gosha' started
Process 'masha' started
...
```

3. Открыть в браузере [http://127.0.0.1:5000/](http://127.0.0.1:5000/) На странице должен отобразится состояние игрового поля.
4. Для завершения игры необходимо завершить процесс `pathfinder.py` в консоли при помощи Ctrl-C

## Принципы игры

При старте приложения игра загружает карту лабиринта и случайным образом раскидывает сокровища по карте. Из директории с программами для роботов загружаются все файлы с расширением .py и игра начинается. Путь к файлу карты и директории с программами игроков настраиваемся в конфигурационном файле.

Программа управления роботом (далее просто "программа") является обычным python файлом с расширение .py. Имя игрока (в web интерфейсе) будет таким же как и имя файла программы. В программе должна быть обязательно определена функция `move(info, ctx)`. Это основная функция управления роботом. В неё передается текущая информация о карте, расположении сокровищ и других игроков. Функция должна вернуть число от 0 до 3, которое обозначает направление следующего хода. Подробности о написании программ управления роботом можно узнать из соответсвующего раздела.

Игра вызывает программу управления роботом через определенные интервалы времени. Если функция `move()` не успеет выполнить нужные расчеты за указанное время, то робот остается не месте и никуда не двигается.

Если в программе робота случается ошибка, то он выходит из строя до конца игры и больше не может собирать сокровища.

В некоторых случаях некорректно написанная программа управления роботом не позволит игре запуститься. Например, если в файле программы не определена функция move(). В этом случае надолибо исправить ошибку в программе робота, либо удалить файл глючной программы. 

## Настройки игры

Все настройки игры хранятся в файле `config`. Его нельзя переименовывать и перемещать. В файле конфигурации две секции: `pathfinders` и `web`. Секция `pathfinders` содержит настройки самой игры.

* `map_file` - файл с картой. Карты лежат в директории `maps`
* `move_timeout` - количество секунд на 1 ход для каждого игрока
* `players` - директория с программами для роботов. Менять не нужно.
* `num_coins` - количество монет на карте. Монеты располагаются на карте в случайном порядке
* `max_moves` - максимальное количество ходов в игре. После достижения максимального количество ходов игра прекращается.

Секция `web` содержит только один параметр: `field_size` - размер клетки игрового поля в пикселях в web интерфейсе. Если поле не вмещается на один экран этот параметр можно уменьшить.

## Собственные карты

Составлять собственные карты легко. Необходимо создать файл с картой (лучше в директории `maps`) и прописать путь к файлу карты в конфигурационный файл игры.

Файл игры выглядит так:
```
#......#........#
#...###...####.#.
....#.....#..#...
....#.......#...#
..#....##........
.......#....###..
.......#....#....
.......#....#....
....####.........
```

`.` - пустое поле
`#` - стена

## Программирование робота
TODO
